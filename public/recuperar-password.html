<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recuperar Contrase√±a - Tour Colombia</title>
    <link rel="stylesheet" href="regstyle.css">
    <style>
        .enlace-container {
            background: #3251b6;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .enlace-container textarea {
            width: 100%;
            height: 80px;
            padding: 10px;
            font-size: 14px;
            border: 2px solid #4CAF50;
            border-radius: 5px;
            resize: none;
        }

        .instrucciones {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            color: #856404;
        }

        div.form-registro h2 {
            margin-bottom: 40px;
            text-align: center;
            text-shadow: #060b07;
            margin-inline-start: 10px;
        }

        div.form-registro p {
            margin-bottom: 5px;
            text-align: center;
            text-shadow: #060b07;
        }

        button.btn-registrar {
            background: #17ab41;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
           justify-content: center;
           display: flex; 
            align-items: center;
            
        }

       .btn-registrar {
    margin: 0 auto;
    display: block;
    font-weight: bold;
}
        button.btn-registrar:hover {
            background: #4b50a9;
        }


        /* Espaciado entre elementos del formulario */
#formRecuperar label {
    margin-top: 20px;
    margin-bottom: 10px;
    display: block;
    font-weight: 600;
    font-size: 20px;
}

#formRecuperar input {
    margin-bottom: 25px;
}

#formRecuperar button {
    margin-top: 15px;
}

/* Espaciado del t√≠tulo y descripci√≥n */
.form-registro h2 {
    margin-bottom: 15px;
}

.form-registro > p {
    margin-bottom: 25px;
    line-height: 1.5;
    font-size: 23px;
}

/* Espaciado del mensaje de error/√©xito */
#mensaje {
    margin-bottom: 20px;
}
    </style>

    
</head>
<body>
    <div class="form-registro">
        <h2>Recuperar Contrase√±a</h2>
        <p>Ingresa tu correo electr√≥nico y te mostraremos el enlace para restablecer tu contrase√±a</p>

        <div id="mensaje" class="mensaje" style="display: none;"></div>

        <form id="formRecuperar">
            <label>Correo electr√≥nico:</label>
            <input type="email" id="correo" class="cubos" 
                   placeholder="tu@email.com" required>

            <button type="submit" class="btn-registrar" style="display: flex; justify-content: center;
            align-items: center;">
                Generar Enlace de Recuperaci√≥n
            </button>
        </form>

        <div id="resultado" style="display: none;">
            <div class="enlace-container">
                <h3 style="color: #4CAF50; margin-top: 0;">‚úÖ Enlace Generado</h3>
                <p style="font-size: 18px; color: #0a0a0a;">
                    Haz clic en "Abrir" para restablecer tu contrase√±a:
                </p>
                <textarea id="enlaceRecuperacion" readonly></textarea>
                
                <button style="background-color: #81b632" type="button" class="btn-copiar" onclick="copiarEnlace()">
                    üìã Copiar Enlace
                </button>
                
                <button style= "background-color: #17ab41" type ="button" class="btn-abrir" onclick="abrirEnlace()">
                    üîó Abrir Enlace para Restablecer
                </button>
            </div>

            <div class="instrucciones">
                <strong>‚ö†Ô∏è Modo de Desarrollo:</strong><br>
                En producci√≥n, este enlace se enviar√≠a autom√°ticamente a tu correo electr√≥nico.
                Por ahora, haz clic en "Abrir Enlace" para continuar.
            </div>
        </div>

        <a href="iniciasession.html" style="margin-top: 15px; display: block; text-align: center; font-size: 22px;">
            ‚Üê Volver a Iniciar Sesi√≥n 
        </a>
    </div>

    <script>
        let enlaceGenerado = '';

        document.getElementById('formRecuperar').addEventListener('submit', async (e) => {
            e.preventDefault();

            const correo = document.getElementById('correo').value;

            // Ocultar resultado anterior si existe
            document.getElementById('resultado').style.display = 'none';

            try {
                const response = await fetch('http://localhost:3000/api/usuarios/solicitar-recuperacion', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ correo })
                });

                const resultado = await response.json();

                if (resultado.success) {
                    mostrarMensaje('Enlace generado exitosamente', 'exito');
                    
                    // Mostrar enlace
                    if (resultado.debug && resultado.debug.enlace) {
                        enlaceGenerado = resultado.debug.enlace;
                        document.getElementById('enlaceRecuperacion').value = enlaceGenerado;
                        document.getElementById('resultado').style.display = 'block';
                    }
                } else {
                    mostrarMensaje(resultado.message, 'error');
                }

            } catch (error) {
                console.error('Error:', error);
                mostrarMensaje('Error de conexi√≥n con el servidor', 'error');
            }
        });

        function copiarEnlace() {
            const textarea = document.getElementById('enlaceRecuperacion');
            textarea.select();
            document.execCommand('copy');
            
            // Cambiar texto del bot√≥n temporalmente
            const btn = event.target;
            const textoOriginal = btn.textContent;
            btn.textContent = '‚úÖ Copiado!';
            btn.style.background = '#4CAF50';
            
            setTimeout(() => {
                btn.textContent = textoOriginal;
                btn.style.background = '#2196F3';
            }, 2000);
        }

        function abrirEnlace() {
            if (enlaceGenerado) {
                window.location.href = enlaceGenerado;
            }
        }

        function mostrarMensaje(texto, tipo) {
            const mensaje = document.getElementById('mensaje');
            mensaje.textContent = texto;
            mensaje.className = 'mensaje ' + tipo;
            mensaje.style.display = 'block';

            // Auto-ocultar despu√©s de 5 segundos
            setTimeout(() => {
                mensaje.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>